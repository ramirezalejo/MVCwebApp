tinymce.PluginManager.add("cmsmodules",function(e,t){function n(){function t(){var t=[{text:"Choose...",value:""}];return e.settings.cmsmodules_url&&0!==e.settings.cmsmodules_url.length?tinymce.util.XHR.send({url:e.settings.cmsmodules_url+"?"+(new Date).getTime(),success:function(e){var n="";tinymce.each(tinymce.util.JSON.parse(e),function(e){if(e.Text.indexOf("->")>0){var u=e.Text.substring(0,e.Text.indexOf("->"));n!=u&&(t.push({text:u,value:u}),n=u)}else t.push({text:e.Text,value:e.Value})})},error:function(e,t,n){alert("Something went wrong in TinyMCE cmsmodules plugin.\nError type: "+e+"\nError status: "+t.status)}}):alert("No cmsmodules_url defined"),t}function n(t){var n=t.control.value(),s=u.find("#cmsModuleValues")[0];s.value(null),s.menu=null,s.hide(),tinymce.util.XHR.send({url:e.settings.cmsmodules_url+"?"+(new Date).getTime(),success:function(e){var t=[],s=!1;if(tinymce.each(tinymce.util.JSON.parse(e),function(e){if(e.Text.indexOf("->")>0){var u=e.Text.substring(0,e.Text.indexOf("->"));n==u&&(s=!0,t.push({text:e.Text.substr(e.Text.indexOf("->")+3),value:e.Value}))}}),s){var l=u.find("#cmsModuleValues")[0];l.value(""),l.menu=null,l.state.data.menu=l.settings.menu=t,l.show()}},error:function(e,t,n){alert("Something went wrong in TinyMCE cmsmodules plugin.\nError type: "+e+"\nError status: "+t.status)}})}var u;u=e.windowManager.open({title:"CMS Modules",width:600,height:140,body:[{type:"ListBox",name:"cmsModuleValue",values:t(),onselect:n},{type:"ListBox",name:"cmsModuleValues",values:[{text:"Choose...",value:""}]}],onsubmit:function(t){e.insertContent(null!=t.data.cmsModuleValues?t.data.cmsModuleValues:t.data.cmsModuleValue)}}),u.find("#cmsModuleValues")[0].hide()}e.addButton("cmsmodules",{text:"M",tooltip:"Insert CMS module",icon:!1,onclick:function(){n()}}),e.addMenuItem("cmsmodules",{text:"Insert CMS module",context:"insert",onclick:function(){n()}})});